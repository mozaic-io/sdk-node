<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Payment Cycles | @mozaic-io/mozaic-sdk-node - v1.0.2-alpha.5</title><meta name="description" content="Documentation for @mozaic-io/mozaic-sdk-node"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">@mozaic-io/mozaic-sdk-node - v1.0.2-alpha.5</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">@mozaic-io/mozaic-sdk-node</a></li><li><a href="Mozaic_SDK.html">Mozaic SDK</a></li><li><a href="Mozaic_SDK.Payment_Cycles.html">Payment Cycles</a></li></ul></div><div class="tsd-panel tsd-typography"><p><a href="Mozaic_SDK.html">Back to the SDK</a></p>
<a id="md:paymentcycles-resource" class="tsd-anchor"></a><h1 class="tsd-anchor-link">PaymentCycles (Resource)<a href="#md:paymentcycles-resource" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>As a company or individual who is going to make a one-time payment of varying amounts to various individuals will create a Payment Cycle. A Payment Cycle has an accounting time period that covers a date range, a memo and a name. These fields can be used for accounting so that the payments for a specific time period can be tracked. A payment cycle goes through several stages. While a payment cycle is in draft, you can continue to make changes to it and add additional payment recipients to it as payment cycle entries. Once you have set all of the details for a payment cycle, the payment cycle is finalized. When finalizing the payment cycle, you specify how you would like to fund it. There are two options: pay using a payment method on file, or pay via invoice. Paying my method on file enables the payment cycle to be processed immediately. Funds are withdrawn from your payment method, and then distributed to all of the payment cycle entries that you defined. If you are paying by invoice, you will need to work with your bank to wire funds to the virtual bank account shown on the invoice. Once the invoice is paid, the money is distributed to the recipients defined in the payment cycle entries.</p>
<a id="md:sequence-diagram-of-a-payment-cycle" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Sequence Diagram of a Payment Cycle<a href="#md:sequence-diagram-of-a-payment-cycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><img src="../media/sequence.png" alt="A sequence diagram of a payment cycle"></p>
<a id="md:example-use-case" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Example Use Case<a href="#md:example-use-case" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>A company would like to pay a list of creators for the month of October. The period will be from October 1st, 2024 to October 31st, 2024. The title will be “October Payments 2024” and the memo will be “Payments for October 1st through October 31st, 2024”.</p>
<p>To create this payment cycle, follow the steps in the Sequence Diagram above which will be illustrated below.</p>
<a id="md:create-a-payment-cycle" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Create a Payment Cycle<a href="#md:create-a-payment-cycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">sdk</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-4">Mozaic</span><span class="hl-1">(&lt;</span><span class="hl-5">End</span><span class="hl-1"> </span><span class="hl-5">Point</span><span class="hl-1">&gt;, &lt;</span><span class="hl-5">Personal</span><span class="hl-1"> </span><span class="hl-5">Access</span><span class="hl-1"> </span><span class="hl-5">Token</span><span class="hl-1">&gt;); </span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">paymentCycle</span><span class="hl-1"> = </span><span class="hl-0">PaymentCycles</span><span class="hl-1">.</span><span class="hl-4">createPaymentCycle</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;October Payments 2024&quot;</span><span class="hl-1">, </span><span class="hl-8">// Title</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;default&quot;</span><span class="hl-1">, </span><span class="hl-8">// Fee Direction</span><br/><span class="hl-1">    </span><span class="hl-7">&quot;Payments for October 1st through October 31st, 2024&quot;</span><span class="hl-1">, </span><span class="hl-8">// Memo</span><br/><span class="hl-1">    </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">(</span><span class="hl-7">&quot;10/1/2024&quot;</span><span class="hl-1">), </span><span class="hl-8">// accounting period start</span><br/><span class="hl-1">    </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">(</span><span class="hl-7">&quot;10/31/2024&quot;</span><span class="hl-1">) </span><span class="hl-8">// accounting period end</span><br/><span class="hl-1">    );</span>
</code><button>Copy</button></pre>

<a id="md:add-payment-entries-to-the-payment-cycles" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Add Payment Entries to the Payment Cycles<a href="#md:add-payment-entries-to-the-payment-cycles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Now that a Payment Cycle has been created, you will add Payment Cycle Entries to the Payment Cycle. Each Payment Cycle Entry represents a single, one-time payment that will be made to the email address specified. This information can be uploaded to the API via a CSV file using the below API endpoint, or you can add Payment Cycle Entries via API calls for item-by-item entry.</p>
<pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">entry1</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-4">addPaymentCycleEntry</span><span class="hl-1">(</span><span class="hl-7">&quot;Jamie Johnson&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;jamie.johnson@noemail.com&quot;</span><span class="hl-1">, </span><span class="hl-9">200</span><span class="hl-1">, </span><span class="hl-7">&quot;USD&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">entry2</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-4">addPaymentCycleEntry</span><span class="hl-1">(</span><span class="hl-7">&quot;Pat Jones&quot;</span><span class="hl-1">, </span><span class="hl-7">&quot;pat.jones@noemail.com&quot;</span><span class="hl-1">, </span><span class="hl-9">100</span><span class="hl-1">, </span><span class="hl-7">&quot;AUD&quot;</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>

<a id="md:funding-a-payment-cycle-with-a-stored-payment-method" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Funding a Payment Cycle with a stored Payment Method<a href="#md:funding-a-payment-cycle-with-a-stored-payment-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>After a Payment Cycle has been created and Payment Cycle Entries have been added to it, the Payment Cycle must be funded so that Payments can be sent to Recipients. If you would like to use a stored debit card or bank account to fund a Payment Cycle, a Payment Method must be selected from your Wallet using the Wallet API. Once finalized, the payment cycle will be processed and payment recipients will be paid.</p>
<pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">wallets</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-0">Wallets</span><span class="hl-1">.</span><span class="hl-4">getWallets</span><span class="hl-1">();</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">stripeWallet</span><span class="hl-1"> = </span><span class="hl-0">wallets</span><span class="hl-1">.</span><span class="hl-4">find</span><span class="hl-1">((</span><span class="hl-0">value</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">value</span><span class="hl-1">.</span><span class="hl-0">key</span><span class="hl-1"> == </span><span class="hl-7">&quot;stripe-us&quot;</span><span class="hl-1">);</span><br/><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-0">paymentMethod</span><span class="hl-1"> = </span><span class="hl-0">stripeWallet</span><span class="hl-1">?.</span><span class="hl-0">paymentMethods</span><span class="hl-1">.</span><span class="hl-4">find</span><span class="hl-1">((</span><span class="hl-0">value</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-0">value</span><span class="hl-1">.</span><span class="hl-0">default</span><span class="hl-1"> == </span><span class="hl-2">true</span><span class="hl-1">);</span><br/><br/><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-0">paymentMethod</span><span class="hl-1"> === </span><span class="hl-2">undefined</span><span class="hl-1"> </span><br/><span class="hl-1">    &amp;&amp; (</span><span class="hl-0">stripeWallet</span><span class="hl-1">?.</span><span class="hl-0">paymentMethods</span><span class="hl-1">.</span><span class="hl-0">length</span><span class="hl-1"> ?? </span><span class="hl-9">0</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1">))</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">        </span><span class="hl-0">paymentMethod</span><span class="hl-1"> = </span><span class="hl-0">stripeWallet</span><span class="hl-1">?.</span><span class="hl-0">paymentMethods</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-0">paymentCycle</span><span class="hl-1"> = </span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-4">finalize</span><span class="hl-1">(</span><span class="hl-0">paymentMethod</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>

<a id="md:funding-a-payment-cycle-with-an-invoice" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Funding a Payment Cycle with an Invoice<a href="#md:funding-a-payment-cycle-with-an-invoice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you would prefer to fund your payment cycle manually, you can do so by paying a Mozaic invoice. Once finalized, you will need to download the invoice and then work with your bank to send payment to the virtual account specified in the Mozaic invoice. If you would like to test this workflow in a non-production environment, please see the example in the <a href="Mozaic_SDK.Invoices.html">Invoices</a> resource.</p>
<pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">finalizedPaymentCycle</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-4">finalizeByInvoice</span><span class="hl-1">();</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">pdfInvoice</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-0">Invoices</span><span class="hl-1">.</span><span class="hl-4">getInvoice</span><span class="hl-1">(</span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-0">invoiceId</span><span class="hl-1">);</span><br/><br/><span class="hl-0">fs</span><span class="hl-1">.</span><span class="hl-4">writeFileSync</span><span class="hl-1">(</span><span class="hl-7">&quot;invoice.pdf&quot;</span><span class="hl-1">, </span><span class="hl-0">Buffer</span><span class="hl-1">.</span><span class="hl-4">from</span><span class="hl-1">(</span><span class="hl-0">pdfInvoice</span><span class="hl-1">));</span>
</code><button>Copy</button></pre>

<a id="md:get-the-status-of-the-payment-cycle-while-it-is-being-processed" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Get the status of the Payment Cycle while it is being processed<a href="#md:get-the-status-of-the-payment-cycle-while-it-is-being-processed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The Payment Cycle is sent to a Mozaic payment partner for fulfillment. The payment partner depends on the Wallet you selected above. When the partner updates the payment cycle status, we make that available to you by updating the status in our records. You can get the overall status of the Payment Cycle, or the individual status of each payment that the Payment Cycle will issue. Note that bigger Payment Cycles can take several minutes to complete, please do not make calls less than 5 minutes apart to the API looking for immediate status. To get real time status, we recommend that you use a <a href="Mozaic_SDK.Web_Hooks.html">web hook</a> instead of polling the Mozaic SDK/API.</p>
<pre><code><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">currentPaymentCycle</span><span class="hl-1"> = </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-0">PaymentCycles</span><span class="hl-1">.</span><span class="hl-4">getPaymentCycle</span><span class="hl-1">(</span><span class="hl-0">oldPaymentCycle</span><span class="hl-1">.</span><span class="hl-0">paymentCycleId</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// Assumes that you have less than 100 entries on your payment cycle.</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">currentPaymentCycleEntries</span><span class="hl-1"> = (</span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">currentPaymentCycle</span><span class="hl-1">).</span><span class="hl-4">getPaymentCycleEntries</span><span class="hl-1">(</span><span class="hl-9">100</span><span class="hl-1">, </span><span class="hl-9">1</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>

<p>Note: If you have more than 100 entries on a single payment cycle, you will need to page through the results to view them all.</p>
<a id="md:get-the-invoice-for-a-payment-cycle" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Get the Invoice for a Payment Cycle<a href="#md:get-the-invoice-for-a-payment-cycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When a Payment Cycle has been completed, you can retrieve an Invoice for your funding payment. The Payment Cycle has a convenience method, or you can use the Invoice resource with the invoice ID. The return value from this method is an ArrayBuffer containing the bytes of a PDF.</p>
<pre><code><span class="hl-8">// Use the convenience method</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">invoice2</span><span class="hl-1"> = </span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-4">getInvoice</span><span class="hl-1">();</span><br/><span class="hl-0">fs</span><span class="hl-1">.</span><span class="hl-4">writeFileSync</span><span class="hl-1">(</span><span class="hl-7">&quot;invoice2.pdf&quot;</span><span class="hl-1">, </span><span class="hl-0">Buffer</span><span class="hl-1">.</span><span class="hl-4">from</span><span class="hl-1">(</span><span class="hl-0">invoice1</span><span class="hl-1">));</span><br/><br/><span class="hl-8">// Or use the resource directly</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-3">invoice1</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">sdk</span><span class="hl-1">.</span><span class="hl-0">Invoices</span><span class="hl-1">.</span><span class="hl-4">getInvoice</span><span class="hl-1">(</span><span class="hl-0">paymentCycle</span><span class="hl-1">.</span><span class="hl-0">invoiceId</span><span class="hl-1">);</span><br/><span class="hl-0">fs</span><span class="hl-1">.</span><span class="hl-4">writeFileSync</span><span class="hl-1">(</span><span class="hl-7">&quot;invoice1.pdf&quot;</span><span class="hl-1">, </span><span class="hl-0">Buffer</span><span class="hl-1">.</span><span class="hl-4">from</span><span class="hl-1">(</span><span class="hl-0">invoice1</span><span class="hl-1">));</span>
</code><button>Copy</button></pre>

</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:paymentcycles-resource"><span>Payment<wbr/>Cycles (<wbr/>Resource)</span></a><ul><li><a href="#md:sequence-diagram-of-a-payment-cycle"><span>Sequence <wbr/>Diagram of a <wbr/>Payment <wbr/>Cycle</span></a></li><li><a href="#md:example-use-case"><span>Example <wbr/>Use <wbr/>Case</span></a></li><li><ul><li><a href="#md:create-a-payment-cycle"><span>Create a <wbr/>Payment <wbr/>Cycle</span></a></li><li><a href="#md:add-payment-entries-to-the-payment-cycles"><span>Add <wbr/>Payment <wbr/>Entries to the <wbr/>Payment <wbr/>Cycles</span></a></li><li><a href="#md:funding-a-payment-cycle-with-a-stored-payment-method"><span>Funding a <wbr/>Payment <wbr/>Cycle with a stored <wbr/>Payment <wbr/>Method</span></a></li><li><a href="#md:funding-a-payment-cycle-with-an-invoice"><span>Funding a <wbr/>Payment <wbr/>Cycle with an <wbr/>Invoice</span></a></li><li><a href="#md:get-the-status-of-the-payment-cycle-while-it-is-being-processed"><span>Get the status of the <wbr/>Payment <wbr/>Cycle while it is being processed</span></a></li><li><a href="#md:get-the-invoice-for-a-payment-cycle"><span>Get the <wbr/>Invoice for a <wbr/>Payment <wbr/>Cycle</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>@mozaic-io/mozaic-sdk-node - v1.0.2-alpha.5</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
